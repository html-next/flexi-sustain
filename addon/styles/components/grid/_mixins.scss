
@mixin make-col($size, $columns, $gutter) {
  position: relative;
  min-height: 1px;
  padding-right: pixel($gutter / 2);
  padding-left:  pixel($gutter / 2);
  flex: 0 0 percentage($size / $columns);
  max-width: percentage($size / $columns);
}


// Media of at least the minimum breakpoint width. No query for the smallest breakpoint.
// Makes the @content apply to the given breakpoint and wider.
@mixin breakpoint-up($name, $breakpoints) {
  $breakpoint: map-get($breakpoints, $name);
  $prefix: nth($breakpoint, 1);
  $min: breakpoint-min($name, $breakpoints);
  @if $min {
    // @media
    @media (min-width: pixel($min)) {
      @content;
    }
  } @else {
    @content;
  }
  .container-#{$prefix} {
    @content;
  }
}

@mixin make-columns($breakpoints, $columns) {
  $breakpoint-counter: 0;
  @each $name, $breakpoint-setup in $breakpoints {
    $bp-prefix: nth($breakpoint-setup, 1);
    $breakpoint-counter: ($breakpoint-counter + 1);

    // @media and @container breakpoints
    @include breakpoint-up($name, $breakpoints) {

      // columns
      @for $i from 1 through $columns {
        .col-#{$bp-prefix}-#{$i} {
          @include make-col($i, $columns, $gutter);
        }
      }

      // offsets
      @for $i from 0 through ($columns - 1) {
        @if $breakpoint-counter != 1 or $i != 0 { // Avoid emitting useless .col-xs-offset-0
          .offset-#{$bp-prefix}-#{$i + 1} {
            margin-left: percentage($i / $columns);
          }
        }
      }

    }
  }
}
